<!-- [file name]: news_site/templates/news_site/search_results.html -->
{% extends "news_site/base.html" %}

{% block title %}–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π - –†–ë–î –ù–¢–ò{% endblock %}

{% block content %}
<nav class="breadcrumb">
    <a href="{% url 'news_site:index' %}">–ì–ª–∞–≤–Ω–∞—è</a> 
    <span>/</span>
    <span>–ü–æ–∏—Å–∫ –Ω–æ–≤–æ—Å—Ç–µ–π</span>
</nav>

<div class="search-page">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="search-hero">
        <h1>–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–≤–æ—Å—Ç—è–º</h1>
        <p>–ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–∞–∑–µ –Ω–∞—É—á–Ω–æ-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π</p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <div class="search-main-form">
        <form method="get" action="{% url 'news_site:search_news' %}">
            <div class="search-input-container">
                <span class="search-icon-large">üîç</span>
                <input type="text" name="q" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å..." 
                       value="{{ query }}" class="search-main-input" autofocus>
            </div>
            
            <button type="submit" class="search-main-btn">
                –ù–∞–π—Ç–∏ –Ω–æ–≤–æ—Å—Ç–∏
            </button>
        </form>

        <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–∫–∞–∑–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <button type="button" class="search-filters-toggle" onclick="toggleFilters()">
            <span>üìã</span>
            –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
        </button>

        <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
        <div class="search-filters" id="searchFilters">
            <form method="get" action="{% url 'news_site:search_news' %}">
                <input type="hidden" name="q" value="{{ query }}">
                
                <div class="filters-row">
                    <div class="filter-group">
                        <label for="section-filter">–†–∞–∑–¥–µ–ª:</label>
                        <select name="section" id="section-filter" class="filter-select">
                            <option value="">–í—Å–µ —Ä–∞–∑–¥–µ–ª—ã</option>
                            {% for section in sections %}
                            <option value="{{ section.slug }}" {% if section_filter == section.slug %}selected{% endif %}>
                                {{ section.title }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="category-filter">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                        <select name="category" id="category-filter" class="filter-select">
                            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}" {% if category_filter == category.id|stringformat:"i" %}selected{% endif %}>
                                {{ category.get_full_path }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <button type="submit" class="search-main-btn" style="margin-top: 15px;">
                    –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </button>
            </form>
        </div>
    </div>

    <!-- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ -->
    <div class="quick-search">
        <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:</h3>
        <div class="quick-search-tags">
            <a href="{% url 'news_site:search_news' %}?q=–Ω–∞—É—á–Ω—ã–µ+–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è" class="quick-search-tag">–ù–∞—É—á–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</a>
            <a href="{% url 'news_site:search_news' %}?q=—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è+–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è" class="quick-search-tag">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a>
            <a href="{% url 'news_site:search_news' %}?q=–Ω–æ–≤—ã–µ+—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏" class="quick-search-tag">–ù–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</a>
            <a href="{% url 'news_site:search_news' %}?q=–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏" class="quick-search-tag">–ò–Ω–Ω–æ–≤–∞—Ü–∏–∏</a>
            <a href="{% url 'news_site:search_news' %}?q=—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏" class="quick-search-tag">–†–∞–∑—Ä–∞–±–æ—Ç–∫–∏</a>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
    {% if query or section_filter or category_filter %}
    <div class="search-results-section">
        <div class="results-header">
            <h2>
                {% if results_count == 0 %}
                –ü–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                {% else %}
                –ù–∞–π–¥–µ–Ω–æ –Ω–æ–≤–æ—Å—Ç–µ–π: {{ results_count }}
                {% endif %}
            </h2>
            
            {% if results_count > 0 %}
            <div class="search-query-info">
                {% if query %}<strong>–ó–∞–ø—Ä–æ—Å:</strong> "{{ query }}"{% endif %}
                {% if selected_section %}| <strong>–†–∞–∑–¥–µ–ª:</strong> {{ selected_section.title }}{% endif %}
                {% if selected_category %}| <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ selected_category.get_full_path }}{% endif %}
                <a href="{% url 'news_site:search_news' %}" class="clear-filters">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</a>
            </div>
            {% endif %}
        </div>

        {% if news_list %}
        <div class="news-list">
            {% for news_item in news_list %}
            <div class="search-result-item">
                <div class="news-header">
                    <h3 class="news-title">
                        <a href="{% url 'news_site:news_detail' news_item.id %}">{{ news_item.title }}</a>
                    </h3>
                    <div class="news-date">{{ news_item.created_at|date:"d.m.Y H:i" }}</div>
                </div>
                
                <div class="news-path">
                    –†–∞–∑–¥–µ–ª: 
                    <a href="{% url 'news_site:section' news_item.section.slug %}">{{ news_item.section.title }}</a>
                    {% if news_item.category %}
                    ‚Üí 
                    <a href="{% url 'news_site:category' news_item.section.slug news_item.category.get_path %}">
                        {{ news_item.category.get_full_path }}
                    </a>
                    {% endif %}
                </div>
                
                {% if news_item.content %}
                <div class="news-content-preview">
                    {{ news_item.content|striptags|truncatewords:50 }}
                </div>
                {% endif %}
                
                {% if news_item.files.all %}
                <div class="news-files">
                    {% for file in news_item.files.all %}
                    <a href="{% url 'news_site:tracked_download' file.id %}" class="file-badge">
                        üìé {{ file.filename }}
                    </a>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% elif query %}
        <div class="no-results">
            <div class="no-results-icon">üîç</div>
            <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
            <div class="search-tips">
                <h4>–°–æ–≤–µ—Ç—ã –ø–æ –ø–æ–∏—Å–∫—É:</h4>
                <ul>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞</li>
                    <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –æ–±—â–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</li>
                    <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ä–∞–∑–¥–µ–ª –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</li>
                    <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ –µ—Å—Ç—å –Ω–æ–≤–æ—Å—Ç–∏</li>
                </ul>
            </div>
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="search-instructions">
        <div class="instructions-icon">üí°</div>
        <h3>–ù–∞—á–Ω–∏—Ç–µ –ø–æ–∏—Å–∫</h3>
        <p>–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –≤ –ø–æ–ª–µ –≤—ã—à–µ –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –±—ã—Å—Ç—Ä—ã–º –ø–æ–∏—Å–∫–æ–º</p>
    </div>
    {% endif %}
</div>

<script>
function toggleFilters() {
    const filters = document.getElementById('searchFilters');
    filters.classList.toggle('active');
}

// –ê–≤—Ç–æ-–æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const sectionFilter = document.getElementById('section-filter');
    const categoryFilter = document.getElementById('category-filter');
    
    if (sectionFilter) {
        sectionFilter.addEventListener('change', function() {
            this.form.submit();
        });
    }
    
    if (categoryFilter) {
        categoryFilter.addEventListener('change', function() {
            this.form.submit();
        });
    }
    
    // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
    const searchInput = document.querySelector('.search-main-input');
    if (searchInput && !searchInput.value) {
        searchInput.focus();
    }
});
</script>
{% endblock %}