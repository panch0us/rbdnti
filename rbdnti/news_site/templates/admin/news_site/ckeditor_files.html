{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
.ckeditor-files {
    margin: 20px 0;
}
.file-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-bottom: 10px;
    background: #f9f9f9;
}
.file-info {
    flex-grow: 1;
}
.file-name {
    font-weight: bold;
    margin-bottom: 5px;
}
.file-path {
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 5px;
    font-family: monospace;
}
.file-meta {
    font-size: 0.85rem;
    color: #666;
}
.file-actions {
    display: flex;
    gap: 10px;
}
.preview-img {
    max-width: 100px;
    max-height: 100px;
    margin-right: 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
}
.file-preview {
    display: flex;
    align-items: center;
}
.empty-files {
    text-align: center;
    padding: 40px;
    color: #666;
}
.folder-stats {
    background: #e7f3ff;
    padding: 10px 15px;
    border-radius: 4px;
    margin-bottom: 20px;
    border-left: 4px solid #3498db;
}
.stats-item {
    margin: 5px 0;
}
.image-extensions {
    color: #27ae60;
    font-weight: bold;
}
</style>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é —Å –æ—à–∏–±–∫–∞–º–∏
document.addEventListener('DOMContentLoaded', function() {
    const images = document.querySelectorAll('.preview-img');
    images.forEach(function(img) {
        img.onerror = function() {
            this.style.display = 'none';
            const errorDiv = this.nextElementSibling;
            if (errorDiv && errorDiv.style.display === 'none') {
                errorDiv.style.display = 'flex';
            }
        };
    });
});
</script>
{% endblock %}

{% block content %}
<div id="content-main">
    <h1>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ CKEditor</h1>
    
    <div class="folder-stats">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
        <div class="stats-item">
            <strong>–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤:</strong> {{ files|length }}
        </div>
        <div class="stats-item">
            <strong>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</strong> 
            <span class="image-extensions">
                {{ files|length }} —Ñ–∞–π–ª–æ–≤
            </span>
        </div>
        <div class="stats-item">
            <strong>–ü—É—Ç—å –∫ —Ñ–∞–π–ª–∞–º:</strong> media/news_files/ckeditor_uploads/
        </div>
    </div>
    
    <div class="module">
        <div class="ckeditor-files">
            {% if files %}
                {% for file in files %}
                <div class="file-item">
                    <div class="file-preview">
                        {% if file.name|lower|slice:'-4:' in '.jpg,.jpeg,.png,.gif,.bmp,.webp' or file.name|lower|slice:'-5:' in '.jpeg,.tiff' %}
                        <img src="{{ file.url }}" alt="{{ file.name }}" class="preview-img" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="width: 100px; height: 100px; background: #e74c3c; color: white; display: none; align-items: center; justify-content: center; margin-right: 15px; border-radius: 4px; flex-direction: column; font-size: 0.8rem;">
                            <span>‚ùå</span>
                            <span>–û—à–∏–±–∫–∞</span>
                            <span>–∑–∞–≥—Ä—É–∑–∫–∏</span>
                        </div>
                        {% else %}
                        <div style="width: 100px; height: 100px; background: #eee; display: flex; align-items: center; justify-content: center; margin-right: 15px; border-radius: 4px; flex-direction: column;">
                            <span style="font-size: 2rem;">üìÑ</span>
                            <span style="font-size: 0.7rem; margin-top: 5px;">{{ file.name|slice:'-4:' }}</span>
                        </div>
                        {% endif %}
                        <div class="file-info">
                            <div class="file-name">{{ file.name }}</div>
                            <div class="file-path">
                                üìÅ {{ file.relative_path }}
                            </div>
                            <div class="file-meta">
                                <strong>–†–∞–∑–º–µ—Ä:</strong> {{ file.size|filesizeformat }} | 
                                <strong>–ó–∞–≥—Ä—É–∂–µ–Ω:</strong> {{ file.uploaded|date:"d.m.Y H:i" }} |
                                <strong>–¢–∏–ø:</strong> 
                                {% if file.name|lower|slice:'-4:' in '.jpg,.jpeg,.png,.gif,.bmp,.webp' or file.name|lower|slice:'-5:' in '.jpeg,.tiff' %}
                                    <span style="color: #27ae60;">üñºÔ∏è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</span>
                                {% else %}
                                    <span style="color: #3498db;">üìÑ –§–∞–π–ª</span>
                                {% endif %}
                            </div>
                            <div class="file-meta">
                                <strong>URL:</strong> 
                                <a href="{{ file.url }}" target="_blank" style="word-break: break-all;">{{ file.url }}</a>
                            </div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <a href="{{ file.url }}" target="_blank" class="button" style="background: #3498db; color: white; padding: 8px 12px; border-radius: 4px; text-decoration: none;">
                            üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </a>
                        <form method="post" action="/delete-ckeditor-file/" style="display: inline;">
                            {% csrf_token %}
                            <input type="hidden" name="filename" value="{{ file.name }}">
                            <input type="hidden" name="filepath" value="{{ file.relative_path }}">
                            <button type="submit" class="button" 
                                    onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª \"{{ file.name }}\"?')" 
                                    style="background: #e74c3c; color: white; padding: 8px 12px; border-radius: 4px; border: none; cursor: pointer;">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-files">
                    <h3>üìÅ –§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–í –ø–∞–ø–∫–µ CKEditor –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</p>
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 4px; border: 1px solid #ffeaa7;">
                        <h4>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</h4>
                        <p>–§–∞–π–ª—ã CKEditor –æ–±—ã—á–Ω–æ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤: <code>media/news_files/ckeditor_uploads/</code></p>
                        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç—Ç–æ–π –ø–∞–ø–∫–∏ –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.</p>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    
    <div class="submit-row" style="padding: 12px 14px; margin: 20px 0; background: #f8f8f8; border: 1px solid #eee; border-radius: 4px; overflow: hidden;">
        <a href="{% url 'admin:news_site_news_changelist' %}" class="button" style="background: #417690; color: white; padding: 10px 15px; border-radius: 4px; text-decoration: none; margin-right: 10px;">
            üìã –ö —Å–ø–∏—Å–∫—É –Ω–æ–≤–æ—Å—Ç–µ–π
        </a>
        <a href="{% url 'admin:index' %}" class="button" style="background: #666; color: white; padding: 10px 15px; border-radius: 4px; text-decoration: none; margin-right: 10px;">
            üè† –í –∞–¥–º–∏–Ω–∫—É
        </a>
        <a href="/ckeditor-files/" class="button" style="background: #27ae60; color: white; padding: 10px 15px; border-radius: 4px; text-decoration: none;">
            üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
        </a>
    </div>
</div>
{% endblock %}